# AWSまとめ
- 闇雲に勉強してもテストの合格は難しい
- 勉強のポイント
    1. AWSのそれぞれのソリューションについて何ができて、何ができないか理解する
    2. AWSのそれぞれのソリューションのエコシステム(関係性的なみたいな！)を理解する
    3. 基本的なITに関する知識を勉強する。
        - 特にネットワーク周りの知識
            - NT、サブネット、VPN、CIDR
        - RAID、SAML、LDAPなど
    4. 少なくとも10数時間以上の自習時間がないと合格は難しい
    5. クイズ感覚で覚えない。問題の解答を考える必要がある

### VPC
- AWSアカウント専用のネットワーク
    - /16から/28のプレフィックス長のCIDRによって作成される
    - 独自のIPアドレス範囲の選択、サブネットの作成、ルートテーブルやネットワークゲートウェイの設定など、仮想ネットワーキングを制御できる
        - サブネットが一つのAZ
        - サブネットは必ず一つのAZの中にしか作れない
            - すなわちサブネットはAZとイコール
        - VPCはサブネットをまたげる
    - サブネット
        - 分離したリソースグループを格納する場所を指定するVPCのIPアドレス範囲
        - /16から/28のプレフィックス長のCIDRによって作成される
        - AWSではCIDRブロック内で最初の4つのIPアドレスと最後のIPアドレスの合計5つが予約されている
        - 指定したサブネット内にAWSリソースを起動できる
        - インターネットゲートウェイにルーティングされるパブリックサブネットとされないプライベートサブネットがある
        - サブネットの範囲が狭いと、オートスケーリングでELBが起動したときにIPが取得できず起動できないことなどがある
        - デフォルトのサブネットがあり、それは最初からインターネットゲートウェイにルーティングされている
            - いわゆるオンプレで普通にサブネットに参加してルーター経由して外に出れる感じで用意されている
        - 新規で作成すると通常はプライベートとなり、自身でIGWをアタッチする必要がある
        - **AWSの各サービスはグローバル、リージョン、AZのどれかに属する**
            - さらに外側にはクラウドフロントというサービスがある

#### VPCまとめ 外側から作成手順
- VPC
    - リージョン内、AZはまたげる
    - IGWをつける場所
    - VGWをつける場所
- サブネット
    - AZ内、AZをまたげない
    - 同じVPC内の別サブネットならセグメント違っても通信できる
- ルートテーブル
    - サブネットと関連付ける
    - デフォルトゲートウェイを0.0.0.0/0に設定するとIGWと紐づきパブリックサブネットとなる。
- NAT(実はインスタンス)
    - サブネット内に作成
    - ElasticIPを必ずふる
    - 送信元/送信先チェックを無効にする必要がある
        - しないと自分宛のトラフィック以外破棄しちゃう
- ネットワークACL
    - サブネット単位につけるファイアーウォール
    - 拒否/許可の設定ができる
- セキュリティグループ
    - インスタンスに適用するファイアーウォール
    - 許可のみの設定ができる
- ロードバランサー(プライムストラテジー内)
    - 位置的には恐らくサブネット、AZの外、VPCの中
    - 負荷分散
    - DNS名を持つ
        - DNSサーバー上で、ロードバランサーのDNS名をインスタンスのCNAME(エイリアス、別名)として登録すると  
        該当DNSインスタンスへのアクセスしてきたトラフィックはまずロードバランサーに入り、そこから振り分け


## AWSが提供する基本サービス
- EC2
  - AZのサービス
  - サーバーの追加・削除、マシンスペック変更も数分で可能
  - 管理者権限(root / Administrator) で利用可能
  - LinuxKVMで動いている
  - EC2のシステム基盤 (AWS Nitro System)
      - 独自のハードウェア/Hypervisorにより最適化された性能を提供
  - EC2で選択できるプロセッサとアーキテクチャ
      - Intel Xeon processor
      - AMD EPYC processor
          -  10% コスト低減
      - AWS Graviton Processor
          -  最大 45% コスト低減
  - APIでインフラの自動化が可能

```bash
$ aws ec2 run-instances ¥
--image-id ami-zzzzzz ¥
--instance-count 3 ¥
--region ap-northeast-1 ¥
--instance-type m5.2xlarge
```
  - EC2インスタンスのネーミングポリシー
    - c5d.xlarge
      - c : インスタンスファミリー
        - M5, M5a, T3, A1 : 汎用型
          - TはCPUのバースト機能がある
        - C5, C5n : コンピューティング最適化
        - I3, H1 D2 : ストレージ最適化
        - X1,R5, Z1d : メモリ最適化
        - F1, P3, G3 : 高速コンピューティング(GPU・FPGA)
          - 3Dの処理をしたい時など、HPC(high perfomance PC)はP3を使うなど
      - 5 : インスタンス世代
        - 同じインスタンスファミリーでも世代が進むにつれ数字が大きくなる。世代が新しい方が高性能でコストパフォーマンスも高いため、極力最新世代のインスタンス利用が推奨
      - d : (追加機能)
      - xlarge : インスタンスサイズ
  - 少し特殊なインスタンスタイプ
    - Amazon EC2 Bare Metal
      - AWSの各種サービスとの連携が可能で、AWSクラウドのメリットを失うことなく、OSが直接下層のハードウェアにアクセス可能
    - T2, T3
        - 負荷に応じて高いレベルまでCPU性能がバーストする機能を持ったパフォーマンスインスタンス
    - AWSはハードウェアを専有できる
    - Amazon EC2 セキュリティグループ
        - 1つ以上のインスタンスのトラフィックを制御する仮想ファイアウォール機能
            - 複数のセキュリティーグループ指定可能
            - 何も設定しなければデフォルトのセキュリティーグループが使用される
        - AZの中でしか使えない
        - Network Access Controlあるよ
            - サブネット毎に設定できるファイアーウォール
    - AWS上でのIPの種類
    - Private IP
        - 必ず割り当てられるIPアドレス
        - EC2作成時にIPを指定可能(VPCのみ)
        - Stop/StartしてもIPは変わらず固定(VPCのみ)
    - Public IP
        - ランダムに割り当てられるPublic IP
        - Stop/Startすると別のIPが割当てられる
        - 割当ての有無を変更することも可能(VPCのみ)
    - Elastic IP (EIP)
        - 別インスタンスへ再マップも可能な静的Public IP
        - Stop/StartしてもIPアドレスが維持される(VPCのみ)
        - 利用していない場合は課金発生
- Elastic Fabric Adapter(EAF) 新サービス：2018/11/26
    - Amazon EC2 インスタンスのネットワークインターフェイスで、数値流体力学、気象モデリング、貯留層シミュレーションなど、高レベルのインスタンス間通信を要する HPC(high-performance computing)アプリケーションを、AWS 上で大規模に実行できます。
- Cluster Placement Group
    - 同じAZ内のインスタンスを理論的にグループ化したもので、通信が早くなるやつ
        - 冗長化を犠牲にしてスループットを上げる、画像処理の速度を上げるには等の問題が出題される
            - スループットとは、一定時間あたりのデータ処理能力のことである。 主に、通信回線におけるデータ転送能力を指す場合が多いが、コンピューターの処理能力を表す場合に使われることもある。
    - 参考
        - AWS上のシングルフロー通信とは、ポイントツーポイントネットワーク接続を意味する
- EC2のストレージ
    1. Amazon EC2 インスタンスストア
        - ホストコンピュータに内蔵されたディスク
        - EC2インスタンスと不可分
        - EC2インスタンスをStop/Terminateするとクリアされる
        - 性能・容量はインスタンスタイプごとに規定
        - 追加費用なし(無料)
    2. EBS(Amazon Elastic Block Store)
        - ネットワークで接続
        - EC2インスタンスとは独立管理
        - EC2インスタンスをStop/TerminateしてもEBSは保持可能
        - Volumeごとに性能・容量を定義可能
        - EBSの費用が別途発生
        - Snapshotを取得しS3に保存可能
        - EBS最適化オプション
            - 通常のネットワークとは別にEBS専用帯域を確保するオプション
            - 起動時に有効/無効を選択可能
            - 最近はデフォルトで有効
- OSイメージ(AMI(Amazon Machine Image))
    - AMIはリージョンサービス
        - 他のリージョンで同じAMIを使用したい場合はコピーする必要がある
    - AMIはインスタンス起動に必要なOSイメージ
        - イメージは内部的にS3に保存
    - AWS以外にサードパーティもAMIを提供
    - 自由に自前のカスタムAMIを作成可能
        - 作成したAMIは別アカウントと共有可能
        - カスタムAMIから何台でもEC2インスタンスを起動可能


- S3
- EBS

- RDS
- ElastCache
- DynamoDB


